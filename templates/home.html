<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fink的小窝 - 聊天小窗</title>
  <meta name="description" content="Fink的小窝 - 一个温馨可爱的实时聊天小站，支持注册、登录、消息互动。" />
  <!-- 设置网页图标（favicon） -->
  <link rel="icon" href="/static/assets/img/icon.ico" type="image/x-icon" />
  <!-- 可选：社交分享图标（Open Graph） -->
  <meta property="og:title" content="Fink的小窝 - 聊天小窗" />
  <meta property="og:description" content="和朋友们一起窝在这里聊天吧！" />
  <meta property="og:image" content="/static/assets/img/logo.webp" />
  <meta property="og:type" content="website" />
  <link rel="manifest" href="/static/manifest.json" />
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZK9F0GE4SE"></script>
  <!-- 本地js和css文件引用 -->
  <link rel="stylesheet" href="/static/css/home.css">
  <script src="/static/js/home.js" defer></script>
</head>

<body>
  <div class="container">

    <!-- 公告弹窗 -->
    <!-- 遮罩层 -->
    <div id="announcement-overlay" style="display: none; position: fixed; top: 0; left: 0;
width: 100vw; height: 100vh; background: rgba(0, 0, 0, 0.3); z-index: 998;">
      <div id="announcement-modal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
         z-index: 999; background: #fffbe6; border: 1px solid #ffe58f;
         padding: 20px 16px; width: 90%; max-width: 400px; border-radius: 8px;
         box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);">

        <div style="display: flex; justify-content: space-between; align-items: start;">
          <div>
            <strong id="announcement-title" style="color: #f2ae26; font-size: 16px;"></strong>
            <p id="announcement-content" style="margin: 6px 0 0; color: #333; font-size: 14px;white-space: pre-line;">
            </p>
          </div>
          <button onclick="closeAnnouncement()"
            style="background: none; border: none; font-weight: bold; cursor: pointer; font-size: 16px;">✕</button>
        </div>

        <button onclick="acknowledgeAnnouncement()" class="confirm-btn">我已知晓</button>
      </div>
    </div>


    <!-- 在线用户列表遮罩 -->
    <div id="online-overlay"
      style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.3); z-index:998;">
    </div>

    <!-- 在线用户列表弹窗 -->
    <div id="online-modal"
      style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%);
  z-index:999; background:#ebeaea; border:1px solid #ccc; border-radius:8px; padding:16px 20px; max-width:300px; width:90%; box-shadow:0 10px 20px rgba(0,0,0,0.2);">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <strong style="font-size:16px; color:#333;">实时在线用户列表</strong>
        <button onclick="closeOnlineList()"
          style="background:none; border:none; font-size:16px; cursor:pointer;">✕</button>
      </div>
      <div id="online-user-list" style="margin-top:12px; font-size:14px; max-height:200px; overflow-y:auto;"></div>
    </div>

    <h1>
      欢迎 <span id="display-username" style="font-weight: bold;"></span> 来到Fink的小窝
    </h1>
    <span id="username" data-username="{{ username }}" data-role="{{ role }}" style="display: none;"></span>

    <div id="top-bar">
      <button id="load-more" onclick="loadMore()">加载更多历史信息</button>
      <button id="online-count-btn" onclick="openOnlineList()">当前在线人数：0</button>
      <button id="logout" onclick="logout()">
        <img src="/static/assets/img/logout.svg" alt="退出" />
      </button>
    </div>

    <div id="chat-box"></div>

    <div id="chat-input">
      <!-- 工具栏按钮 + 工具栏 -->
      <div id="tool-container">
        <button id="tool-toggle-btn">
          <img id="tool-icon" src="/static/assets/img/add.svg" alt="工具" />
        </button>
        <!-- 工具栏 -->
        <div id="tool-bar">
          <button onclick="sendToolCommand('/roll')">
            <img src="/static/assets/img/dice.svg" alt="骰子" />
          </button>
          <button onclick="sendToolCommand('/time')">
            <img src="/static/assets/img/clock.svg" alt="时间" />
          </button>
        </div>
      </div>
      <input type="text" id="message" placeholder="输入消息..." />
      <button class="send-btn" onclick="sendMessage()">发送</button>
    </div>



    <div id="footer">
      © 2025 Fink ·
      <a href="https://github.com/finkkk/fink_chat" target="_blank">开源地址</a>
      · {{ version }} · 更新:{{ updated }}
    </div>
  </div>

  <div id="ai-warning" style="
  display: none;
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  background-color: #f87171;
  color: white;
  padding: 10px 16px;
  border-radius: 8px;
  font-size: 14px;
  font-weight: bold;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  z-index: 9999;
  ">
    🤖 请等待 AI 思考完毕再发送！
  </div>
</body>

</html>